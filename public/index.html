<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top builds</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var whTooltips = {
            colorLinks: true,
            iconizeLinks: true,
            renameLinks: false,
            iconSize: "medium",
        };
    </script>
    <script src="https://wow.zamimg.com/widgets/power.js"></script>
    <script src='https://cdn.jsdelivr.net/g/lodash@4(lodash.min.js+lodash.fp.min.js)'></script>
    <script src="https://cdn.jsdelivr.net/gh/shakrmedia/petal@0.11.1/dist/petal.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/shakrmedia/petal@0.11.1/dist/petal.min.css">
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <div class="start-spinner">
        
    </div>
    <div id="root" class="dark">
        <div class="controls section">
            <form class="form-inline">
                <div class="form-group">
                    <div class="input-group">
                        <label class="input-addon" for="class">Select class</label>
                        <select name="class" class="select" v-model="className" @change="setSpecs">
                            <option v-for="classInfo in classes" :value="classInfo.value">{{ classInfo.title }}</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <label class="input-addon" for="spec">Select spec</label>
                        <select name="spec" class="select" v-model="spec">
                            <option v-for="spec in specs" :value="spec.value">{{ spec.title }}</option>
                        </select>
                    </div>
                </div>
                <button @click="filter" class="btn">Show</button>
            </form>
        </div>
        <div class="section controls">
            <button
                @click="mode='stats'"
                class="btn whitetext red"
                :class="{ hollow: mode !== 'stats' }"
            >
                Stats
            </button>
            <button
                @click="mode='talents'"
                class="btn whitetext red"
                :class="{ hollow: mode !== 'talents' }"
            >
                Talents
            </button>
            <button
                @click="mode='azeritePowers'"
                class="btn whitetext red"
                :class="{ hollow: mode !== 'azeritePowers' }"
            >
                Azerite powers
            </button>
            <button
                @click="mode='essences'"
                class="btn whitetext red"
                :class="{ hollow: mode !== 'essences' }"
            >
                Essences
            </button>
            <button
                @click="mode='corrupts'"
                class="btn whitetext red"
                :class="{ hollow: mode !== 'corrupts' }"
            >
                Corrupts
            </button>
        </div>
        <div class="section progress" v-if="chars.length > 0">
            <div class="progress__row">
                <div class="bg-green-d2" :style="{ 'flex-basis': (hoveredSpellFrequency() || chars.length) / chars.length * 100 + '%' }"></div>
            </div>
            <h6 class="progress__title text-blue" v-if="hoveredSpellFrequency() === 0">
                Hover a <span v-if="mode !== 'stats'">spell</span><span v-if="mode === 'stats'">statistic's priority</span> to see it's frequency
            </h6>
            <h6 class="progress__title" v-if="hoveredSpellFrequency() > 0">
                Usages: {{ hoveredSpellFrequency() }}/{{ chars.length }}
            </h6>
        </div>
        <div class="section loader" v-if="chars.length === 0 && fetchMode.length">
            <span class="spinner spinning big"><span></span></span>
            {{ fetchMode }}
        </div>
        <div class="section results" v-if="chars.length > 0">
            <div v-for="(char, index) in chars" class="results__item">
                <h5 class="name">
                    {{ index + 1 }}. {{ char.name }} ({{ char.realm.name }})
                </h5>
                <p v-if="mode === 'corrupts'">{{ char.corruptionLevel }} corruption</p>
                <div
                    class="stat-list"
                    v-if="mode === 'stats'"
                    :class="{ grayed: hoveredSpell && hoveredSpell !== statsToId(char.mainStats) }"
                    @mouseover="hoveredSpell = statsToId(char.mainStats)"
                    @mouseleave="hoveredSpell = null"
                >
                    <p
                        class="stat-list__item"
                        :key="'mainStat' + mainStat.title"
                        v-for="mainStat in char.mainStats"
                    >
                        <b class="stat-list__item-title">
                            {{ humanify(mainStat.title) }}
                        </b>
                        <span class="stat-list__item-value">
                            {{ mainStat.value }}
                        </span>
                        <i class="petalicon petalicon-chevron-right stat-list__item-icon"></i>
                    </p>
                </div>
                <div
                    class="stat-list"
                    v-if="mode === 'stats'"
                    :class="{ grayed: hoveredSpell && hoveredSpell !== statsToId(char.offStats) }"
                    @mouseover="hoveredSpell = statsToId(char.offStats)"
                    @mouseleave="hoveredSpell = null"
                >
                    <p
                        class="stat-list__item"
                        :key="'offStat' + offStat.title"
                        v-for="offStat in char.offStats"
                    >
                        <b class="stat-list__item-title">
                            {{ humanify(offStat.title) }}
                        </b>
                        <span class="stat-list__item-value">
                            {{ offStat.value }}
                        </span>
                        <i class="petalicon petalicon-chevron-right stat-list__item-icon"></i>
                    </p>
                </div>
                <div
                    class="stat-list"
                    v-if="mode === 'stats'"
                    :class="{ grayed: hoveredSpell && hoveredSpell !== statsToId(char.defStats) }"
                    @mouseover="hoveredSpell = statsToId(char.defStats)"
                    @mouseleave="hoveredSpell = null"
                >
                    <p
                        class="stat-list__item"
                        :key="'defStats' + defStats.title"
                        v-for="defStats in char.defStats"
                    >
                        <b class="stat-list__item-title">
                            {{ humanify(defStats.title) }}
                        </b>
                        <span class="stat-list__item-value">
                            {{ defStats.value }}
                        </span>
                        <i class="petalicon petalicon-chevron-right stat-list__item-icon"></i>
                    </p>
                </div>
                <div class="spell-row" v-if="mode === 'azeritePowers'">
                    <a href="#"
                        :data-wowhead="'spell=' + azeritePower.id"
                        class="spell spell_statified"
                        :class="{ grayed: hoveredSpell && hoveredSpell !== azeritePower.name }"
                        :key="'azeritePower' + azeritePower.id"
                        v-for="azeritePower in char.azeritePowers"
                        @mouseover="hoveredSpell = azeritePower.name"
                        @mouseleave="hoveredSpell = null"
                    >
                        <h6
                            :class="{ 'text-red': azeritePower.freq === 3, 'text-blue': azeritePower.freq === 2 }"
                        >
                            x{{ azeritePower.freq }}
                        </h6>
                    </a>
                </div>
                <div class="spell-row" v-if="mode === 'talents'">
                    <a href="#"
                        :data-wowhead="'spell=' + talent"
                        class="spell"
                        :class="{ grayed: hoveredSpell && hoveredSpell !== talent }"
                        :key="'talent' + talent"
                        v-for="talent in char.talents"
                        @mouseover="hoveredSpell = talent"
                        @mouseleave="hoveredSpell = null"
                    ></a>
                </div>
                <div class="spell-row" v-if="mode === 'essences'">
                    <a href="#"
                        :data-wowhead="'spell=' + essences"
                        class="spell"
                        :class="{ grayed: hoveredSpell && hoveredSpell !== essences }"
                        :key="'essences' + essences"
                        v-for="essences in char.essences"
                        @mouseover="hoveredSpell = essences"
                        @mouseleave="hoveredSpell = null"
                    ></a>
                </div>
                <div class="spell-row" v-if="mode === 'corrupts'">
                    <a href="#"
                        :data-wowhead="'spell=' + corrupt.id"
                        class="spell spell_statified"
                        :class="{ grayed: hoveredSpell && hoveredSpell !== corrupt.name }"
                        :key="'corrupt' + corrupt.id"
                        v-for="corrupt in char.corrupts"
                        @mouseover="hoveredSpell = corrupt.name"
                        @mouseleave="hoveredSpell = null"
                    >
                        <h6
                            :class="{ 'text-blue': corrupt.freq === 2 }"
                        >
                            x{{ corrupt.freq }}
                        </h6>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="./index.js"></script>
</body>

</html>